version: '3'
services:
  zookeeper:
    image: wurstmeister/zookeeper
    container_name: zookeeper
    restart: always
    ports:
      - "2181:2181"

  kafka:
    image: wurstmeister/kafka
    container_name: kafka
    restart: always
    ports:
      - "9092:9092"
      - "29092:29092"
    depends_on:
      - zookeeper
    links:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181'
      ALLOW_PLAINTEXT_LISTENER: "yes"
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_LISTENERS: PLAINTEXT://:9092,PLAINTEXT_HOST://:29092
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092
      KAFKA_CREATE_TOPICS: "t_locations:1:1"
      KAFKA_TOPIC: "t_locations"

  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch-oss:7.9.3
    container_name: elasticsearch
    restart: unless-stopped
    ports:
      - "9200:9200"
      - "9300:9300"
    environment:
      cluster.name: es-cluster
      discovery.type: single-node
      bootstrap.memory_lock: "true"
      ES_JAVA_OPTS: "-Xms512m -Xmx512m"
    healthcheck:
      test: "curl -f http://localhost:9200 || exit 1"
    ulimits:
      memlock:
        soft: -1
        hard: -1

  zipkin:
    image: openzipkin/zipkin
    container_name: zipkin
    environment:
      - STORAGE_TYPE=mem
      # Uncomment to disable scribe
      # - SCRIBE_ENABLED=false
      # Uncomment to enable self-tracing
      # - SELF_TRACING_ENABLED=true
      # Uncomment to enable debug logging
      # - JAVA_OPTS=-Dlogging.level.zipkin=DEBUG
    ports:
      - '9411:9411'

#  discovery-service:
#    image: discovery-service
#    build: ./discovery-service
#    ports:
#      - '8761:8761'
#    restart: on-failure
#    depends_on:
#      - kafka
#      - zipkin
#      - elasticsearch
#
#  config-service:
#    image: config-service
#    build: ./config-service
#    ports:
#      - '8888:8888'
#    restart: on-failure
#    links:
#      - discovery-service
#
#  zuul-gateway-service:
#    image: zuul-gateway-service
#    build: ./zuul-gateway-service
#    ports:
#      - '9000:9000'
#    links:
#      - config-service
#      - discovery-service
#    restart: on-failure

#  hystrix-dashboard-service:
#    image: hystrix-dashboard-service
#    build: ./hystrix-dashboard
#    ports:
#      - '9090:9090'
#    depends_on:
#      discovery-service:
#        condition: service_started
#    restart: on-failure
#
#  user-service:
#    image: user-service
#    build: ./user-service
#    ports:
#      - '9001:9001'
#    depends_on:
#      discovery-service:
#        condition: service_started
#      zuul-gateway-service:
#        condition: service_started
#    restart: on-failure
